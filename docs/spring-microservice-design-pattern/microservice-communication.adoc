== 微服务之间的通信

服务可以使用基于同步请求/响应的通信机制,例如: HTTP REST 或 gRPC.
也可以使用基于消息的通信机制,比如 AMQP.

远程过程调用 OpenFeign、RestTemplate、dubbo、gRPC、

断路器 hystrix、Retry、Resilience

[source,xml]
----
<dependency>
    <groupId>org.springframework.retry</groupId>
    <artifactId>spring-retry</artifactId>
</dependency>
----

[source,java]
----
@Slf4j
@Service
public class RetryServiceImpl {

    private static final String REMOTE_URL = "https://www.baidu.com";

    @Resource
    private RestTemplate restTemplate;

    @Retryable(value = Exception.class, maxAttempts = 2, backoff = @Backoff(delay = 1000L, multiplier = 1.5))
    public String retry(String id) {
        log.info("进入了 retry 方法 id:" + id);
        return restTemplate.getForObject(REMOTE_URL + id, String.class);
    }

    /**
     * 当进入异常时, 会尝试2次, 2次都不成功时会进入这个方法, 并返回结果
     *
     * @param e  异常信息
     * @param id retry参数
     * @return String
     */
    @Recover
    public String recover(Exception e, String id) {
        log.warn("进入了 recover 方法:" + id);
        return "recover";
    }
}
----

服务注册发现 eureka、zookeeper、consul、nacos、k8s service

异步消息 rocketmq, kafka

交互方式 同步：一对一，请求/响应， 异步：一对多，异步请求/响应，单向通知， 发布订阅，发布/异步响应






